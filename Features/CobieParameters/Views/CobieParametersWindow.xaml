<Window
    x:Class="COBIeManager.Features.CobieParameters.Views.CobieParametersWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:viewModels="clr-namespace:COBIeManager.Features.CobieParameters.ViewModels"
    xmlns:converters="clr-namespace:COBIeManager.Shared.Converters"
    Title="COBie Parameters" Height="600" Width="900"
    WindowStartupLocation="CenterOwner"
    Background="{DynamicResource MaterialDesignPaper}"
    FontFamily="{DynamicResource MaterialDesignFont}">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Custom app styles (includes MaterialDesign themes) -->
                <ResourceDictionary Source="/COBIeManager;component/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <converters:BoolToAuthStatusConverter x:Key="BoolToAuthStatusConverter"/>
            <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
       
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Auth Section -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
            <TextBlock Text="Authentication Status:" VerticalAlignment="Center" FontWeight="Medium"/>
            <TextBlock Text="{Binding IsAuthenticated, Converter={StaticResource BoolToAuthStatusConverter}}"
                       Margin="8,0,16,0" VerticalAlignment="Center">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsAuthenticated}" Value="True">
                                <Setter Property="Foreground" Value="Green"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsAuthenticated}" Value="False">
                                <Setter Property="Foreground" Value="Red"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <Button Content="Login" Command="{Binding LoginCommand}"
                    Visibility="{Binding IsAuthenticated, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>
        </StackPanel>

        <!-- Toolbar -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <Button Content="Select All" Command="{Binding SelectAllCommand}" Margin="0,0,4,0"/>
                <Button Content="Deselect All" Command="{Binding DeselectAllCommand}" Margin="0,0,4,0"/>
                <Button Command="{Binding LoadParametersCommand}" ToolTip="Refresh">
                    <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Parameters List -->
        <Border Grid.Row="2" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1"
                Background="{DynamicResource MaterialDesignCardBackground}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Parameters}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <CheckBox Content="{Binding Name}"
                                      IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                      Margin="8,4"
                                      IsEnabled="True"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- Loading Overlay -->
        <Grid Grid.Row="2" Background="{DynamicResource MaterialDesignPaper}"
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Margin="0,0,0,16"/>
                <TextBlock Text="Loading..." HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Footer -->
        <Grid Grid.Row="3" Margin="0,16,0,0">
            <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"
                       TextWrapping="Wrap" MaxWidth="600"/>
            <Button Content="Add to Project" Command="{Binding AddToProjectCommand}"
                    HorizontalAlignment="Right" Style="{StaticResource MaterialDesignRaisedButton}"
                    IsEnabled="{Binding IsAuthenticated}"/>
        </Grid>
    </Grid>

</Window>
